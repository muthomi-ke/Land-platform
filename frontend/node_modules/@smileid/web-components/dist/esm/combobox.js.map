{"version":3,"file":"combobox.js","sources":["../../lib/components/combobox/src/Combobox.js"],"sourcesContent":["function generateId(prefix) {\n  const id = [...Array(30)].map(() => Math.random().toString(36)[3]).join('');\n  return `${prefix}-${id}`;\n}\n\n// check if element is visible in browser view port\nfunction isElementInView(element) {\n  const bounding = element.getBoundingClientRect();\n\n  return (\n    bounding.top >= 0 &&\n    bounding.left >= 0 &&\n    bounding.bottom <=\n      (window.innerHeight || document.documentElement.clientHeight) &&\n    bounding.right <=\n      (window.innerWidth || document.documentElement.clientWidth)\n  );\n}\n\n// check if an element is currently scrollable\nfunction isScrollable(element) {\n  return element && element.clientHeight < element.scrollHeight;\n}\n\n// ensure a given child element is within the parent's visible scroll area\n// if the child is not visible, scroll the parent\nfunction maintainScrollVisibility(activeElement, scrollParent) {\n  const { offsetHeight, offsetTop } = activeElement;\n  const { offsetHeight: parentOffsetHeight, scrollTop } = scrollParent;\n\n  const isAbove = offsetTop < scrollTop;\n  const isBelow = offsetTop + offsetHeight > scrollTop + parentOffsetHeight;\n\n  if (isAbove) {\n    scrollParent.scrollTo(0, offsetTop);\n  } else if (isBelow) {\n    scrollParent.scrollTo(0, offsetTop - parentOffsetHeight + offsetHeight);\n  }\n}\n\nclass ComboboxRoot extends HTMLElement {\n  constructor() {\n    super();\n\n    this.handleRoaming = this.handleRoaming.bind(this);\n  }\n\n  connectedCallback() {\n    this.trigger = this.querySelector('smileid-combobox-trigger');\n\n    document.addEventListener('click', this.handleRoaming);\n    this.addEventListener('focusout', this.handleRoaming);\n    this.addEventListener('blur', this.handleRoaming);\n  }\n\n  disconnectedCallback() {\n    document.removeEventListener('click', this.handleRoaming);\n    this.removeEventListener('focusout', this.handleRoaming);\n    this.removeEventListener('blur', this.handleRoaming);\n  }\n\n  handleRoaming(event) {\n    const target = event.relatedTarget || event.target;\n    if (this.contains(target)) {\n      return;\n    }\n\n    if (this.trigger.getAttribute('expanded') === 'true') {\n      this.trigger.setAttribute('expanded', 'false');\n    }\n  }\n}\n\nclass ComboboxTrigger extends HTMLElement {\n  constructor() {\n    super();\n\n    this.handleKeyUp = this.handleKeyUp.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.handleSelection = this.handleSelection.bind(this);\n\n    this.toggleExpansionState = this.toggleExpansionState.bind(this);\n  }\n\n  get type() {\n    return this.getAttribute('type') || 'text';\n  }\n\n  get label() {\n    return this.getAttribute('label') || '';\n  }\n\n  get value() {\n    return this.getAttribute('value') || '';\n  }\n\n  get disabled() {\n    return this.hasAttribute('disabled');\n  }\n\n  connectedCallback() {\n    if (!this.label) {\n      throw new Error('<combobox-trigger>: a label attribute is required');\n    }\n\n    this.innerHTML = `${\n      this.type === 'text'\n        ? `\n        <div>\n          <input ${this.value ? `value=\"${this.value}\" ` : ''}${\n            this.disabled ? ' disabled ' : ''\n          }type=\"text\" placeholder=\"${this.label}\" />\n          <button ${this.disabled ? 'disabled ' : ''}tabindex='-1' type='button'>\n            <span class=\"visually-hidden\">Toggle</span>\n          </button>\n        </div>\n      `\n        : `<button ${this.disabled ? 'disabled ' : ''}type=\"button\">${\n            this.value || this.label\n          }</button>`\n    }`;\n\n    this.setAttribute('expanded', false);\n\n    this.inputTrigger = this.querySelector('input');\n    this.buttonTrigger = this.querySelector('button');\n\n    this.buttonTrigger.setAttribute('aria-expanded', false);\n    this.buttonTrigger.setAttribute('role', 'combobox');\n\n    this.buttonTrigger.addEventListener('keydown', this.handleKeyDown);\n    this.buttonTrigger.addEventListener('click', this.toggleExpansionState);\n\n    if (this.inputTrigger) {\n      this.inputTrigger.setAttribute('aria-expanded', false);\n      this.inputTrigger.setAttribute('role', 'combobox');\n\n      this.inputTrigger.addEventListener('keydown', this.handleKeyDown);\n      this.inputTrigger.addEventListener('keyup', this.handleKeyUp);\n      this.inputTrigger.addEventListener('change', (e) => e.stopPropagation());\n    }\n\n    this.listbox = this.parentElement.querySelector('smileid-combobox-listbox');\n\n    this.options = Array.from(\n      this.parentElement.querySelectorAll('smileid-combobox-option'),\n    );\n    this.options.forEach((node) => {\n      node.addEventListener('combobox.option.select', this.handleSelection);\n    });\n  }\n\n  disconnectedCallback() {\n    this.buttonTrigger.removeEventListener('keydown', this.handleKeyDown);\n    this.buttonTrigger.removeEventListener('click', this.toggleExpansionState);\n\n    if (this.inputTrigger) {\n      this.inputTrigger.removeEventListener('keydown', this.handleKeyDown);\n      this.inputTrigger.removeEventListener('keyup', this.handleKeyUp);\n      this.inputTrigger.removeEventListener('change', (e) =>\n        e.stopPropagation(),\n      );\n    }\n\n    if (this.options) {\n      this.options.forEach((node) => {\n        node.removeEventListener(\n          'combobox.option.select',\n          this.handleSelection,\n        );\n      });\n    }\n  }\n\n  handleKeyDown(event) {\n    if (event.ctrlKey || event.shiftKey) {\n      return;\n    }\n\n    const { key } = event;\n\n    switch (key) {\n      case 'Enter':\n      case 'Space':\n      case ' ':\n        if (this.getAttribute('expanded') === 'true') {\n          if (this.inputTrigger && (key === 'Space' || key === ' ')) {\n            this.resetListbox();\n          } else {\n            event.preventDefault();\n            const selectedOption = this.buttonTrigger.getAttribute(\n              'aria-activedescendant',\n            );\n            if (selectedOption) {\n              document.getElementById(selectedOption).click();\n            }\n          }\n        } else {\n          event.preventDefault();\n          this.toggleExpansionState();\n        }\n        break;\n      case 'Esc':\n      case 'Escape':\n        event.preventDefault();\n        if (this.getAttribute('expanded') === 'true') {\n          this.toggleExpansionState();\n        }\n        break;\n      case 'Down':\n      case 'ArrowDown':\n        event.preventDefault();\n        if (this.getAttribute('expanded') !== 'true') {\n          this.toggleExpansionState();\n          this.focusListbox('First');\n        } else {\n          this.focusListbox('Down');\n        }\n        break;\n      case 'Up':\n      case 'ArrowUp':\n        event.preventDefault();\n        if (this.getAttribute('expanded') !== 'true') {\n          this.toggleExpansionState();\n          this.focusListbox('Last');\n        } else {\n          this.focusListbox('Up');\n        }\n        break;\n      case 'Left':\n      case 'ArrowLeft':\n      case 'Right':\n      case 'ArrowRight':\n      case 'Home':\n      case 'End':\n        this.resetListbox();\n        break;\n      case 'Tab':\n        break;\n      default:\n        break;\n    }\n  }\n\n  handleKeyUp(event) {\n    const { key } = event;\n\n    const isPrintableCharacter = (str) => str.length === 1 && str.match(/\\S| /);\n\n    if (event.key === 'Escape' || event.key === 'Esc') {\n      event.preventDefault();\n      if (this.getAttribute('expanded') === 'true') {\n        this.toggleExpansionState();\n      } else if (this.inputTrigger) {\n        this.inputTrigger.value = '';\n\n        this.listbox.dispatchEvent(\n          new CustomEvent('combobox.listbox.filter', { detail: '' }),\n        );\n      }\n    }\n\n    if (isPrintableCharacter(key) || key === 'Backspace') {\n      this.resetListbox();\n      this.filterListbox(event.target.value);\n    }\n  }\n\n  toggleExpansionState() {\n    const listboxIsExpanded = this.getAttribute('expanded') === 'true';\n    this.setAttribute('expanded', !listboxIsExpanded);\n    this.buttonTrigger.setAttribute('aria-expanded', !listboxIsExpanded);\n    if (this.inputTrigger) {\n      this.inputTrigger.setAttribute('aria-expanded', !listboxIsExpanded);\n    }\n  }\n\n  handleSelection(event) {\n    if (this.inputTrigger) {\n      this.inputTrigger.value = event.detail.label;\n    } else {\n      this.buttonTrigger.textContent = event.detail.label;\n    }\n\n    this.toggleExpansionState();\n    this.parentElement.dispatchEvent(\n      new CustomEvent('combobox.change', {\n        detail: {\n          value: event.detail.value,\n        },\n      }),\n    );\n  }\n\n  filterListbox(value) {\n    if (this.getAttribute('expanded') !== 'true') {\n      this.toggleExpansionState();\n    }\n\n    this.listbox.dispatchEvent(\n      new CustomEvent('combobox.listbox.filter', { detail: value }),\n    );\n  }\n\n  focusListbox(direction) {\n    this.resetListbox();\n    this.listbox.dispatchEvent(\n      new CustomEvent('combobox.listbox.focus', {\n        detail: {\n          direction,\n        },\n      }),\n    );\n  }\n\n  resetListbox() {\n    this.listbox.dispatchEvent(new CustomEvent('combobox.listbox.reset'));\n  }\n}\n\nclass ComboboxListbox extends HTMLElement {\n  constructor() {\n    super();\n\n    this.handleFilter = this.handleFilter.bind(this);\n    this.handleFocus = this.handleFocus.bind(this);\n    this.handleReset = this.handleReset.bind(this);\n\n    this.handleOptionSelection = this.handleOptionSelection.bind(this);\n  }\n\n  get emptyLabel() {\n    return this.getAttribute('empty-label');\n  }\n\n  get emptyState() {\n    return `\n      <p id='empty-state' style=\"text-align: center;\">\n        ${this.emptyLabel || 'No items'}\n      </p>\n    `;\n  }\n\n  connectedCallback() {\n    this.setAttribute('role', 'listbox');\n    this.setAttribute('id', generateId('listbox'));\n\n    this.addEventListener('combobox.listbox.filter', this.handleFilter);\n    this.addEventListener('combobox.listbox.focus', this.handleFocus);\n    this.addEventListener('combobox.listbox.reset', this.handleReset);\n\n    this.triggers = Array.from(\n      this.parentElement.querySelectorAll(\n        'smileid-combobox-trigger input, smileid-combobox-trigger button',\n      ),\n    );\n    this.triggers.forEach((node) =>\n      node.setAttribute('aria-controls', this.getAttribute('id')),\n    );\n\n    this.optionNodes = Array.from(\n      this.querySelectorAll('smileid-combobox-option'),\n    );\n    this.selectedNode =\n      this.optionNodes.find(\n        (node) =>\n          !node.hasAttribute('hidden') && node.hasAttribute('aria-selected'),\n      ) || this.optionNodes.filter((node) => !node.hasAttribute('hidden'))[0];\n    this.selectedNode.setAttribute('tabindex', '0');\n\n    this.optionNodes.forEach((node) => {\n      node.addEventListener(\n        'combobox.option.select',\n        this.handleOptionSelection,\n      );\n    });\n\n    if (this.optionNodes.length === 0) {\n      this.innerHTML = this.emptyState;\n    }\n  }\n\n  disconnectedCallback() {\n    this.removeEventListener('combobox.listbox.filter', this.handleFilter);\n    this.removeEventListener('combobox.listbox.focus', this.handleFocus);\n    this.removeEventListener('combobox.listbox.reset', this.handleReset);\n    this.optionNodes.forEach((node) => {\n      node.removeEventListener(\n        'combobox.option.select',\n        this.handleOptionSelection,\n      );\n    });\n  }\n\n  static get observedAttributes() {\n    return ['search-term'];\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    switch (name) {\n      case 'search-term':\n        if (oldValue && !newValue) {\n          this.optionNodes.forEach((node) => {\n            node.removeAttribute('hidden');\n          });\n        } else if (newValue) {\n          this.filterNodes(newValue);\n        }\n        break;\n      default:\n        break;\n    }\n  }\n\n  filterNodes(searchTerm) {\n    this.optionNodes.forEach((node) => {\n      const value = node.getAttribute('value').toLowerCase();\n      const label = node.getAttribute('label').toLowerCase();\n\n      const containsSearchTerm =\n        value.includes(searchTerm.toLowerCase()) ||\n        label.includes(searchTerm.toLowerCase());\n\n      if (containsSearchTerm) {\n        node.removeAttribute('hidden');\n      } else {\n        node.setAttribute('hidden', true);\n      }\n    });\n\n    const optionsVisible = this.optionNodes.find(\n      (node) => !node.hasAttribute('hidden'),\n    );\n    const emptyState = this.querySelector('#empty-state');\n\n    if (!optionsVisible && !emptyState) {\n      this.insertAdjacentHTML('afterbegin', this.emptyState);\n    } else if (optionsVisible && emptyState) {\n      this.removeChild(emptyState);\n    }\n  }\n\n  handleFilter(event) {\n    const searchTerm = event.detail;\n    this.setAttribute('search-term', searchTerm);\n  }\n\n  handleFocus(event) {\n    this.setSelected(event.detail.direction);\n  }\n\n  handleReset() {\n    this.optionNodes.forEach((node) => node.setAttribute('tabindex', '-1'));\n  }\n\n  handleOptionSelection(event) {\n    const inputTrigger = this.triggers.filter(\n      (node) => node.tagName === 'INPUT',\n    )[0];\n\n    if (inputTrigger) {\n      this.setAttribute('search-term', event.detail.label);\n    }\n  }\n\n  setSelected(direction) {\n    const visibleOptions = this.optionNodes.filter(\n      (node) => !node.hasAttribute('hidden'),\n    );\n    this.selectedNode.setAttribute('tabindex', '0');\n    const currentIndex = visibleOptions.findIndex(\n      (node) => node === this.selectedNode,\n    );\n    const lastIndex = visibleOptions.length - 1;\n\n    let nextIndex;\n    switch (direction) {\n      case 'First':\n        nextIndex = 0;\n        break;\n      case 'Last':\n        nextIndex = lastIndex;\n        break;\n      case 'Up':\n        if (currentIndex === 0) {\n          nextIndex = lastIndex;\n        } else {\n          nextIndex = currentIndex - 1;\n        }\n        break;\n      default:\n        if (currentIndex === lastIndex) {\n          nextIndex = 0;\n        } else {\n          nextIndex = currentIndex + 1;\n        }\n        break;\n    }\n\n    if (currentIndex !== nextIndex) {\n      this.swapSelected(this.selectedNode, visibleOptions[nextIndex]);\n    }\n  }\n\n  swapSelected(currentNode, newNode) {\n    currentNode.setAttribute('tabindex', '-1');\n    newNode.setAttribute('tabindex', '0');\n\n    this.selectedNode = newNode;\n\n    // ACTION: ensure the new option is in view\n    if (isScrollable(this)) {\n      maintainScrollVisibility(this.selectedNode, this);\n    }\n\n    // ACTION: scroll into view if node is not visible\n    if (!isElementInView(newNode)) {\n      newNode.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n    }\n\n    this.triggers.forEach((node) =>\n      node.setAttribute('aria-activedescendant', newNode.id),\n    );\n  }\n}\n\nclass ComboboxOption extends HTMLElement {\n  connectedCallback() {\n    this.setAttribute('role', 'option');\n    this.setAttribute('tabindex', '-1');\n    this.setAttribute('id', generateId('option'));\n\n    this.options = Array.from(\n      this.parentElement.querySelectorAll('smileid-combobox-option'),\n    );\n    this.addEventListener('click', this.select);\n  }\n\n  disconnectedCallback() {\n    this.removeEventListener('click', this.select);\n  }\n\n  get value() {\n    return this.getAttribute('value');\n  }\n\n  get label() {\n    return this.getAttribute('label');\n  }\n\n  select() {\n    const selectedOption = this.options.find((node) =>\n      node.getAttribute('aria-selected'),\n    );\n\n    if (selectedOption) {\n      selectedOption.removeAttribute('aria-selected');\n    }\n\n    this.setAttribute('aria-selected', true);\n\n    this.dispatchEvent(\n      new CustomEvent('combobox.option.select', {\n        detail: {\n          id: this.getAttribute('id'),\n          label: this.label,\n          value: this.value,\n        },\n      }),\n    );\n  }\n}\n\nconst Root = ComboboxRoot;\nconst Trigger = ComboboxTrigger;\nconst List = ComboboxListbox;\nconst Option = ComboboxOption;\n\nif (\n  'customElements' in window &&\n  !window.customElements.get('smileid-combobox')\n) {\n  window.customElements.define('smileid-combobox', Root);\n  window.customElements.define('smileid-combobox-trigger', Trigger);\n  window.customElements.define('smileid-combobox-listbox', List);\n  window.customElements.define('smileid-combobox-option', Option);\n}\n\nexport { Root, Trigger, List, Option };\n"],"names":["generateId","prefix","id","isElementInView","element","bounding","isScrollable","maintainScrollVisibility","activeElement","scrollParent","offsetHeight","offsetTop","parentOffsetHeight","scrollTop","isAbove","isBelow","ComboboxRoot","event","target","ComboboxTrigger","e","node","key","selectedOption","isPrintableCharacter","str","listboxIsExpanded","value","direction","ComboboxListbox","name","oldValue","newValue","searchTerm","label","optionsVisible","emptyState","visibleOptions","currentIndex","lastIndex","nextIndex","currentNode","newNode","ComboboxOption","Root","Trigger","List","Option"],"mappings":"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"}